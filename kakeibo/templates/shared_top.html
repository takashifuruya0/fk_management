{% extends "base.html" %}
{% load humanize %}
{% load my_templatetags %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

{% block title %}
共通家計簿
{% endblock %}

{% block page-title %}
共通家計簿
{% endblock %}

{% block body %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.3.2"></script>
<div class="container-fluid">
  <div class="row">
    <!--基本メニュ-->
    <div class="col-md-8">
      <div class="card">
        <div class="card-header bg-warning">
          <h2 class="card-title">
            共通家計簿（{{today}}）
            {%if is_black %}
            <span class="badge bg-dark">黒字</span>
            {% else %}
            <span class="badge bg-danger">赤字</span>
            {% endif %}
          </h2>
        </div>
        <div class="card-body">
          <h4>支出</h4>
          <div class="progress" style="height:25px">
            <div class="progress-bar" role="progressbar" style="width: {{p_payment.takashi}}%"
                 aria-valuenow="{{p_budget.takashi}}" aria-valuemin="0" aria-valuemax="100"
            >敬士 ：{{payment.takashi |yen}}</div>
            <div class="progress-bar bg-success" role="progressbar" style="width: {{p_payment.hoko}}%"
                 aria-valuenow="{{p_budget.hoko}}" aria-valuemin="0" aria-valuemax="100"
            >朋子：{{payment.hoko |yen}}</div>
          </div>
          <hr>
          <h4>予算</h4>
          <div class="progress" style="height:25px">
            <div class="progress-bar" role="progressbar" style="width: {{p_budget.takashi}}%"
                 aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"
            >敬士 ：{{budget.takashi |yen}}</div>
            <div class="progress-bar bg-success" role="progressbar" style="width: {{p_budget.hoko}}%"
                 aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"
            >朋子：{{budget.hoko |yen}}</div>
            {% if not is_black %}
            <div class="progress-bar bg-danger" role="progressbar" style="width: {{p_budget.over}}%"
                 aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"
            >Over：{{diff |yen_no_color}}</div>
            {% endif %}
          </div>

          <hr>
          <h4>内訳</h4>
          <table class="table">
            <tr>
              <th>支出</th>
              <td>{{payment.total |yen}}</td>
            </tr>
            <tr>
              <th>予算</th>
              <td>{{budget.total |yen}}</td>
            </tr>
          </table>
        </div>
        <div class="card-footer">
          <a class="btn btn-info" href="{%url 'kakeibo:shared_list'%}">レコード一覧</a>
        </div>
      </div>
    </div>

    <!--Chart.js-->
    <div class="col-md-4">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h2 class="card-title">Chart.js</h2>
        </div>
        <div class="card-body">
          <canvas id="chart_bar" width="500" height="500"></canvas>
          <hr>
          <canvas id="chart_pie" width="500" height="500"></canvas>
        </div>
      </div>
    </div>

  </div>
</div>

<!--Chart.js-->
<script>
let ctx = document.getElementById("chart_bar").getContext("2d");
const diff = {{diff}};
let diff_half = 0;
if (diff > 0) {
  diff_half = diff /2;
}
let chart = new Chart(ctx, {
  type: "bar",
  data: {
     labels: ["予算（朋子）", "支払（朋子）", "予算（敬士）", "支払（敬士）"],
     datasets: [
        {
          label: "精算",
          backgroundColor: "#79AEC8",
          borderColor: "#417690",
          data: [0, {{seisan}}, 0, 0]
        },
        {
          label: "予算",
          backgroundColor: "#C879AE",
          borderColor: "#904176",
          data: [{{budget.hoko}}, 0, {{budget.takashi}}, 0]
        },
        {
          label: "赤字",
          backgroundColor: "#AEC879",
          borderColor: "#904176",
          data: [diff_half, 0, diff_half, 0]
        },
        {
          label: "支払",
          backgroundColor: "#5ED91E",
          borderColor: "#904176",
          data: [0, {{payment.hoko}}, 0, {{payment.takashi}}]
        },
     ],
  },
  options: {
    title: {
      text: "Gross Volume in 2020",
      display: true
    },
    scales: {
      y: {
        beginAtZero: true,
        stacked: true,
      },
      x: {
        stacked: true,
      }
    }
  }
});

let ctx_pie = document.getElementById("chart_pie").getContext("2d");

let chart_pie = new Chart(ctx_pie, {
  type: "pie",
  data: {
     labels: ["食費", "家賃", "電気", "水道", "ガス", "日用消耗品"],
     datasets: [
        {
          label: "Yen (¥)",
          data: [30000, 104000, 5000, 7500, 3500, 10000],
          backgroundColor: [
          "#2ecc71",
          "#3498db",
          "#95a5a6",
          "#9b59b6",
          "#f1c40f",
          "#e74c3c",
          "#34495e",
         ]
        }
     ]
  },
  options: {
    title: {
      text: "Pie",
      display: true
    },
  }
});
</script>
{% endblock %}